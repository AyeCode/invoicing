function wpinvBlock(e,i){i=void 0!==i&&""!==i?i:WPInv_Admin.loading;var t=jQuery(e);t.data("GetPaidIsBlocked")?t.data("GetPaidIsBlocked",t.data("GetPaidIsBlocked")+1):(t.data("GetPaidIsBlocked",1),t.data("GetPaidWasRelative",t.hasClass("position-relative")),t.addClass("position-relative"),t.append('<div class="w-100 h-100 position-absolute bg-light d-flex justify-content-center align-items-center getpaid-block-ui" style="top: 0; left: 0; opacity: 0.7; cursor: progress;"><div class="spinner-border" role="status"><span class="sr-only">'+i+"</span></div></div>"))}function wpinvUnblock(e){var i=jQuery(e);if(i.data("GetPaidIsBlocked")){if(i.data("GetPaidIsBlocked")-1>0)return void i.data("GetPaidIsBlocked",i.data("GetPaidIsBlocked")-1);i.data("GetPaidIsBlocked",0),i.data("GetPaidWasRelative")||i.removeClass("position-relative"),i.children(".getpaid-block-ui").remove()}}window.getpaid=window.getpaid||{},getpaid.init_select2_item_search=function(e,i){i||(i=jQuery("#getpaid-add-items-to-invoice"));var t=jQuery(e).data("ignore");jQuery(e).select2({minimumInputLength:3,allowClear:!1,dropdownParent:i,ajax:{url:WPInv_Admin.ajax_url,delay:250,data:function(e){return{action:"wpinv_get_invoicing_items",search:e.term,_ajax_nonce:WPInv_Admin.wpinv_nonce,ignore:t,post_id:WPInv_Admin.post_ID}},processResults:function(e){return e.success?{results:e.data}:{results:[]}}},templateResult:function(e){return e.loading?WPInv_Admin.searching:e.id?jQuery("<span>"+e.text+"</span>"):e.text},language:{inputTooShort:function(){return WPInv_Admin.search_items}}})},getpaid.init_select2_customer_search=function(e,i){i||(i=jQuery(e).parent()),jQuery(e).select2({minimumInputLength:3,allowClear:!1,dropdownParent:i,ajax:{url:WPInv_Admin.ajax_url,delay:250,data:function(e){return{action:"wpinv_get_customers",search:e.term,_ajax_nonce:WPInv_Admin.wpinv_nonce,post_id:WPInv_Admin.post_ID}},processResults:function(e){return e.success?{results:e.data}:{results:[]}}},templateResult:function(e){return e.loading?WPInv_Admin.searching:e.id?jQuery("<span>"+e.text+"</span>"):e.text},language:{inputTooShort:function(){return WPInv_Admin.search_customers}}})},getpaid.currency=new Intl.NumberFormat(void 0,{style:"currency",currency:WPInv_Admin.currency}),jQuery((function(e){function i(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}if(jQuery().tooltip&&e(".wpi-help-tip").tooltip({content:function(){return e(this).prop("title")},tooltipClass:"wpi-ui-tooltip",position:{my:"center top",at:"center bottom+10",collision:"flipfit"},hide:{duration:200},show:{duration:200}}),jQuery("select.wpi_select2").length>0&&(jQuery("select.wpi_select2").select2(),jQuery("select.wpi_select2_nostd").select2({allow_single_deselect:"true"})),e(".getpaid-ajax-item-selector").each((function(){var i=e(this);getpaid.init_select2_item_search(i,e(i).parent())})),e(".getpaid-customer-search").each((function(){var i=e(this);getpaid.init_select2_customer_search(i,e(i).parent())})),e(".getpaid-install-plugin-siwtch-div").on("click",(function(i){i.preventDefault();var t=e(this).find("input");t.prop("checked",!t.prop("checked"))})),e(".getpaid-merge-tags").click((function(){const i=e(this).parent().find(".getpaid-merge-tags-content");i.hasClass("d-none")&&i.css({display:"none"})&&i.removeClass("d-none"),i.slideToggle("fast")})),e("#wpinv_is_recurring").length){var t=function(){e("body").toggleClass("getpaid_is_subscription_item",e("#wpinv_is_recurring").is(":checked")),e("body").toggleClass("getpaid_is_not_subscription_item",!e("#wpinv_is_recurring").is(":checked")),e(".getpaid-price-input").toggleClass("col-sm-4",e("#wpinv_is_recurring").is(":checked")),e(".getpaid-price-input").toggleClass("col-sm-12",!e("#wpinv_is_recurring").is(":checked"))};t(),e(document).on("change","#wpinv_is_recurring",t)}if(e("#wpinv_name_your_price").length){var n=function(){e("body").toggleClass("getpaid_is_dynamic_item",e("#wpinv_name_your_price").is(":checked")),e("body").toggleClass("getpaid_is_not_dynamic_item",!e("#wpinv_name_your_price").is(":checked"))};n(),e(document).on("change","#wpinv_name_your_price",n)}function a(i){i&&i.preventDefault();var t=e(".getpaid-recalculate-prices-on-change").serialize();t+="&action=wpinv_recalculate_full_prices&post_id="+e("#post_ID").val()+"&_ajax_nonce="+WPInv_Admin.wpinv_nonce,wpinvBlock("#wpinv_items_wrap"),e.post(WPInv_Admin.ajax_url,t).done((function(i){i.success&&(i.data.alert?alert(i.data.alert):(e("#wpinv_items_wrap").replaceWith(i.data.table),e("body").trigger("getpaid_on_recalculate_full_prices",i.data)))})).always((function(e){wpinvUnblock("#wpinv_items_wrap")}))}if(e("body.post-type-wpi_item #postexcerpt h2.hndle").text(WPInv_Admin.item_description),e("body.post-type-wpi_discount #postexcerpt h2.hndle").text(WPInv_Admin.discount_description),e("body.getpaid-is-invoice-cpt #postexcerpt h2.hndle").text(WPInv_Admin.invoice_description),e("body.getpaid-is-invoice-cpt #postexcerpt p, body.post-type-wpi_item #postexcerpt p, body.post-type-wpi_discount #postexcerpt p").hide(),e(document).on("change","#wpinv_discount_type",(function(){e("#wpinv_discount_amount_wrap").removeClass("flat percent"),e("#wpinv_discount_amount_wrap").addClass(e(this).val())})),e("#getpaid-invoice-fill-user-details").on("click",(function(i){i.preventDefault();var t=e(this).closest(".bsui"),n=t.find("#wpinv_post_author_override").val();if(n&&!e(this).attr("disabled")){e("#wpinv_first_name, #wpinv_last_name, #wpinv_address, #wpinv_city, #wpinv_zip, #wpinv_company, #wpinv_company_id, #wpinv_phone, #wpinv_vat_number").val(""),wpinvBlock(t);var a={action:"wpinv_get_billing_details",user_id:n,post_id:WPInv_Admin.post_ID,_ajax_nonce:WPInv_Admin.wpinv_nonce};e.get(WPInv_Admin.ajax_url,a).done((function(i){i.success&&(e.each(i.data,(function(i,t){var n=e("#wpinv_"+i);n.length&&n.val(t)})),d())})).always((function(e){wpinvUnblock(t)}))}})),e("#wpinv_post_author_override").on("change",(function(){e(".getpaid-is-invoice-cpt #post_author_override").val(e("#wpinv_post_author_override").val()),e("#getpaid-invoice-fill-user-details").trigger("click")})),e(".getpaid-is-invoice-cpt #post_author_override").replaceWith('<input name="post_author_override" id="post_author_override">'),e(".getpaid-is-invoice-cpt #post_author_override").val(e("#wpinv_post_author_override").val()),e("#getpaid-invoice-create-new-user-button").on("click",(function(i){i.preventDefault(),e("#getpaid-invoice-user-id-wrapper, #getpaid-invoice-create-new-user-button").addClass("d-none"),e("#getpaid-invoice-cancel-create-new-user, #getpaid-invoice-email-wrapper").removeClass("d-none"),e("#getpaid-invoice-fill-user-details").attr("disabled",!0),e("#getpaid-invoice-create-new-user").val(1),e("#getpaid-invoice-new-user-email").prop("required","required"),e("#wpinv_first_name, #wpinv_last_name, #wpinv_company, #wpinv_vat_number, #wpinv_address, #wpinv_city, #wpinv_zip, #wpinv_phone").val("")})),e("#getpaid-invoice-cancel-create-new-user").on("click",(function(i){i.preventDefault(),e("#getpaid-invoice-cancel-create-new-user, #getpaid-invoice-email-wrapper").addClass("d-none"),e("#getpaid-invoice-user-id-wrapper, #getpaid-invoice-create-new-user-button").removeClass("d-none"),e("#getpaid-invoice-fill-user-details").attr("disabled",!1),e("#getpaid-invoice-create-new-user").val(0),e("#getpaid-invoice-new-user-email").val("").prop("required",!1)})),e("#getpaid-invoice-new-user-email").on("change",(function(i){i.preventDefault(),e(this).removeClass("is-invalid").parent().find(".invalid-feedback").remove();var t=e(this).closest(".bsui"),n=e(this).val();wpinvBlock(t);var a={action:"wpinv_check_new_user_email",email:n,post_id:WPInv_Admin.post_ID,_ajax_nonce:WPInv_Admin.wpinv_nonce};e.get(WPInv_Admin.ajax_url,a).done((function(i){if(i.success){if(i.data.id){var t=i.data.id;e("#getpaid-invoice-cancel-create-new-user").trigger("click"),e("#wpinv_post_author_override").find("option[value="+t+"]").length?e("#wpinv_post_author_override").val(t).trigger("change"):e("#wpinv_post_author_override").append(new Option(n,t,!0,!0)).trigger("change")}}else e("#getpaid-invoice-new-user-email").addClass("is-invalid").parent().append('<div class="invalid-feedback">'+i+"</div>")})).always((function(e){wpinvUnblock(t)}))})),e(".getpaid-is-invoice-cpt").on("change","#wpinv_country",(function(i){if(e("#wpinv_state").length){var t=e(this).closest(".row");wpinvBlock(t);var n={action:"wpinv_get_aui_states_field",country:e("#wpinv_country").val(),state:e("#wpinv_state").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce};e.get(WPInv_Admin.ajax_url,n).done((function(i){i.success&&(e("#wpinv_state").closest(".form-group").replaceWith(i.data.html),i.data.select&&e("#wpinv_state").select2())})).always((function(e){wpinvUnblock(t)}))}})),e("#wpinv_template").on("change",(function(i){e(this).closest("#poststuff").removeClass("amount quantity hours").addClass(e(this).val())})),e("#wpinv_template").trigger("change"),function(){var t=[];e("#getpaid-add-items-to-invoice tbody").data("row",e("#getpaid-add-items-to-invoice tbody").html()),e(".getpaid-add-invoice-item-select").select2({dropdownParent:e("#getpaid-add-items-to-invoice .modal-body")}),e(".getpaid-add-invoice-item-select").data("key",i()),e("#getpaid-add-items-to-invoice").on("change",".getpaid-add-invoice-item-select",(function(n){var a=e(this),o=a.data("key");if(a.val()){var s=e.inArray(o,t);if(-1!=s&&t.splice(s,1),!t.length){o=i();var d=e("#getpaid-add-items-to-invoice tbody").data("row");(d=e(d).appendTo("#getpaid-add-items-to-invoice tbody")).find(".getpaid-add-invoice-item-select").data("key",o).select2({dropdownParent:e("#getpaid-add-items-to-invoice .modal-body")}),t.push(o),e("#getpaid-add-items-to-invoice").modal("handleUpdate")}}else-1==e.inArray(o,t)&&t.push(o)}));var n=function(){t=[],e("#getpaid-add-items-to-invoice tbody").html(e("#getpaid-add-items-to-invoice tbody").data("row")),e(".getpaid-add-invoice-item-select").select2({dropdownParent:e("#getpaid-add-items-to-invoice .modal-body")}),e(".getpaid-add-invoice-item-select").data("key",i())};e("#getpaid-add-items-to-invoice .getpaid-cancel").on("click",n),e("#getpaid-add-items-to-invoice .getpaid-add").on("click",(function(){var i=e("#getpaid-add-items-to-invoice tbody tr").map((function(){if(e(this).find("select").val())return{id:e(this).find("select").val(),qty:e(this).find("input").val()}})).get();if(n(),i.length){wpinvBlock(".getpaid-invoice-items-inner");var t={action:"wpinv_add_invoice_items",post_id:e("#post_ID").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce,items:i};e.post(WPInv_Admin.ajax_url,t).done((function(e){e.success&&(s(e.data.items),e.data.alert&&alert(e.data.alert),d())})).always((function(e){wpinvUnblock(".getpaid-invoice-items-inner")}))}}))}(),e(".getpaid-is-invoice-cpt").on("change",".getpaid-recalculate-prices-on-change",a),e(".getpaid-is-invoice-cpt #wpinv-items").on("click",".wpinv-item-remove",(function(){e(this).closest("tr").remove(),a()})),e(".getpaid-is-invoice-cpt").on("click","#wpinv-recalc-totals",a),e(".getpaid-is-invoice-cpt").on("click","#wpinv-add-item",(function(i){i.preventDefault();var t={action:"wpinv_admin_add_invoice_item",post_id:e("#post_ID").val(),item_id:e("#wpinv_invoice_item").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce};wpinvBlock("#wpinv_items_wrap"),e.post(WPInv_Admin.ajax_url,t).done((function(i){i.success&&(i.data.alert?alert(i.data.alert):(e(".wpinv-line-items").append(i.data.row),a()))})).always((function(e){wpinvUnblock("#wpinv_items_wrap")}))})),e(".getpaid-is-invoice-cpt").on("click","#wpinv-new-item",(function(i){i.preventDefault(),e("#wpinv-quick-add").slideToggle("fast")})),e(".getpaid-is-invoice-cpt").on("click","#wpinv-cancel-item",(function(i){return i.preventDefault(),e("#wpinv-quick-add").slideToggle("fast"),e("#_wpinv_quick_vat_rule, #_wpinv_quick_vat_class, #_wpinv_quick_type").prop("selectedIndex",0),e(".wpinv-quick-item-name, .wpinv-quick-item-price, .wpinv-quick-item-qty, .wpinv-quick-item-price, .wpinv-quick-item-description").val(""),!1})),e(".getpaid-is-invoice-cpt").on("click","#wpinv-save-item",(function(i){i.preventDefault();var t={action:"wpinv_create_invoice_item",invoice_id:e("#post_ID").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce,_wpinv_quick:{name:e(".wpinv-quick-item-name").val(),price:e(".wpinv-quick-item-price").val(),qty:e(".wpinv-quick-item-qty").val(),description:e(".wpinv-quick-item-description").val(),type:e(".wpinv-quick-type").val(),vat_rule:e(".wpinv-quick-vat-rule").val(),vat_class:e(".wpinv-quick-vat-class").val(),"one-time":e("#_wpinv_quick-one-time").is(":checked")?1:0}};t._wpinv_quick.name?t._wpinv_quick.price?(wpinvBlock("#wpinv_items_wrap"),e.post(WPInv_Admin.ajax_url,t).done((function(i){i.success&&(i.data.alert?alert(i.data.alert):(e(".wpinv-line-items").append(i.data.row),a()))})).always((function(e){wpinvUnblock("#wpinv_items_wrap")}))):e(".wpinv-quick-item-price").focus():e(".wpinv-quick-item-name").focus()})),e("#wpinv-items .getpaid-invoice-items-inner").hasClass("has-items")){var o={action:"wpinv_get_invoice_items",post_id:e("#post_ID").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce};wpinvBlock(".getpaid-invoice-items-inner"),e.post(WPInv_Admin.ajax_url,o).done((function(e){e.success&&s(e.data.items)})).always((function(e){wpinvUnblock(".getpaid-invoice-items-inner")}))}function s(i){e("tr.getpaid-invoice-item").remove();var t="no-items";e.each(i,(function(i,n){t="has-items";var a=e("tr.getpaid-invoice-item-template").clone();a.removeClass("getpaid-invoice-item-template d-none").addClass("getpaid-invoice-item item-"+n.id),e.each(n.texts,(function(e,i){a.find("."+e).html(i)})),a.data("inputs",n.inputs).appendTo("#wpinv-items .getpaid_invoice_line_items")})),e(".getpaid-invoice-items-inner").removeClass("no-items has-items").addClass(t)}function d(){var i={country:e("#wpinv_country").val(),state:e("#wpinv_state").val(),currency:e("#wpinv_currency").val(),taxes:e("#wpinv_taxable:checked").length,action:"wpinv_recalculate_invoice_totals",post_id:e("#post_ID").val(),discount_code:e("#wpinv_discount_code").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce};e("#wpinv_vat_number").length&&(i.vat_number=e("#wpinv_vat_number").val()),wpinvBlock(".getpaid-invoice-items-inner"),e.post(WPInv_Admin.ajax_url,i).done((function(i){if(i.success){var t=i.data.totals;e.each(t,(function(i,t){e("tr.getpaid-totals-"+i).find(".value").html(t)})),i.data.alert&&alert(i.data.alert)}})).always((function(e){wpinvUnblock(".getpaid-invoice-items-inner")}))}e(".getpaid-is-invoice-cpt").on("click",".getpaid-item-actions .dashicons-trash",(function(i){i.preventDefault(),wpinvBlock(".getpaid-invoice-items-inner");var t=e(this).closest(".getpaid-invoice-item").data("inputs"),n=this,a={action:"wpinv_remove_invoice_item",post_id:e("#post_ID").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce,item_id:t["item-id"]};e.post(WPInv_Admin.ajax_url,a).done((function(i){i.success&&(e(n).closest(".getpaid-invoice-item").remove(),e(".getpaid-invoice-items-inner").removeClass("no-items has-items"),e("tr.getpaid-invoice-item").length?e(".getpaid-invoice-items-inner").addClass("has-items"):e(".getpaid-invoice-items-inner").addClass("no-items"),d())})).always((function(e){wpinvUnblock(".getpaid-invoice-items-inner")}))})),e(".getpaid-is-invoice-cpt").on("click",".getpaid-item-actions .dashicons-edit",(function(i){i.preventDefault();var t=e(this).closest(".getpaid-invoice-item").data("inputs");(e.each(t,(function(i,t){e("#getpaid-edit-invoice-item .getpaid-edit-item-div ."+i).val(t)})),window.bootstrap&&window.bootstrap.Modal)?new window.bootstrap.Modal(document.getElementById("getpaid-edit-invoice-item")).show():e("#getpaid-edit-invoice-item").modal()})),e("#getpaid-edit-invoice-item .getpaid-cancel").on("click",(function(){e("#getpaid-edit-invoice-item .getpaid-edit-item-div :input").val("")})),e("#getpaid-create-invoice-item .getpaid-cancel").on("click",(function(){e("#getpaid-create-invoice-item .getpaid-create-item-div :input").val("")})),e("#getpaid-edit-invoice-item .getpaid-save").on("click",(function(){var i=e("#getpaid-edit-invoice-item .getpaid-edit-item-div :input").map((function(){return{field:e(this).attr("name"),value:e(this).val()}})).get();e("#getpaid-edit-invoice-item .getpaid-edit-item-div :input").val(""),wpinvBlock(".getpaid-invoice-items-inner");var t={action:"wpinv_edit_invoice_item",post_id:e("#post_ID").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce,data:i};e.post(WPInv_Admin.ajax_url,t).done((function(e){e.success&&(s(e.data.items),e.data.alert&&alert(e.data.alert),d())})).always((function(e){wpinvUnblock(".getpaid-invoice-items-inner")}))})),e("#getpaid-create-invoice-item .getpaid-save").on("click",(function(){var i=e("#getpaid-create-invoice-item .getpaid-create-item-div :input").map((function(){return{field:e(this).attr("name"),value:e(this).val()}})).get();e("#getpaid-create-invoice-item .getpaid-create-item-div :input").val(""),wpinvBlock(".getpaid-invoice-items-inner");var t={action:"wpinv_create_invoice_item",post_id:e("#post_ID").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce,data:i};e.post(WPInv_Admin.ajax_url,t).done((function(e){e.success&&(s(e.data.items),e.data.alert&&alert(e.data.alert),d())})).always((function(e){wpinvUnblock(".getpaid-invoice-items-inner")}))})),e("#wpinv-items .recalculate-totals-button").on("click",(function(e){e.preventDefault(),d()})),e(".getpaid-is-invoice-cpt #wpinv_vat_number, .getpaid-is-invoice-cpt #wpinv_discount_code, .getpaid-is-invoice-cpt #wpinv_taxable").on("change",(function(e){e.preventDefault()})),e(".getpaid-is-invoice-cpt").on("change","#wpinv_country, #wpinv_state",(function(e){d()})),e('.getpaid-is-invoice-cpt form#post [name="post_status"]').attr("type","hidden");var c,r={init:function(){e("#wpinv-notes").on("click","a.add_note",this.add_invoice_note).on("click","a.delete_note",this.delete_invoice_note),e("ul.invoice_notes")[0]&&(e("ul.invoice_notes")[0].scrollTop=e("ul.invoice_notes")[0].scrollHeight)},add_invoice_note:function(){if(e("textarea#add_invoice_note").val()){wpinvBlock("#wpinv-notes");var i={action:"wpinv_add_note",post_id:WPInv_Admin.post_ID,note:e("textarea#add_invoice_note").val(),note_type:e("select#invoice_note_type").val(),_nonce:WPInv_Admin.add_invoice_note_nonce};return e.post(WPInv_Admin.ajax_url,i,(function(i){e("ul.invoice_notes").append(i),e("ul.invoice_notes")[0].scrollTop=e("ul.invoice_notes")[0].scrollHeight,wpinvUnblock("#wpinv-notes"),e("#add_invoice_note").val("")})),!1}},delete_invoice_note:function(i){i.preventDefault();var t=e(this).data("id");e(this).closest("li.note").remove(),e.post(WPInv_Admin.ajax_url,{action:"wpinv_delete_note",note_id:t,_nonce:WPInv_Admin.delete_invoice_note_nonce})}};r.init(),jQuery("#wpinv-details .inside").html()&&(jQuery("#submitpost",jQuery(".wpinv")).detach().appendTo(jQuery("#wpinv-details")),jQuery("#submitdiv",jQuery(".wpinv")).remove(),jQuery("#publishing-action","#wpinv-details").find("input[type=submit]").attr("name","save_invoice").val(WPInv_Admin.save_invoice)),jQuery("#wpinv-address.postbox").html()&&(jQuery("#wpinv_post_author_override","#authordiv").remove(),jQuery("#authordiv",jQuery(".wpinv")).hide()),!jQuery('#post input[name="post_title"]').val()&&(c=jQuery('#wpinv-details input[name="wpinv_number"]').val())&&jQuery('#post input[name="post_title"]').val(c);var p=jQuery(".getpaid-is-invoice-cpt .subsubsub");if(p.is(":visible")){var l=jQuery(".publish",p).find(".count").text();jQuery(".publish",p).find("a").html(WPInv_Admin.status_publish+' <span class="count">'+l+"</span>");var v=jQuery(".wpi-pending",p).find(".count").text();jQuery(".pending",p).find("a").html(WPInv_Admin.status_pending+' <span class="count">'+v+"</span>")}var _=function(){if(e(".getpaid_js_field-country").length&&e(".getpaid_js_field-state").length){e(".getpaid_js_field-state").fadeTo(1e3,.4);var i=e(".getpaid_js_field-state").is(".custom-select, .form-control"),t=e(".getpaid_js_field-state").attr("class"),n={action:"wpinv_get_states_field",country:e(".getpaid_js_field-country").val(),field_name:e(".getpaid_js_field-country").attr("name").replace("country","state"),class:e(".getpaid_js_field-state").attr("class")};e.post(WPInv_Admin.ajax_url,n).done((function(a){var o=e(".getpaid_js_field-state").val();if("nostates"==a){if(i)var s='<input type="text" name="'+n.field_name+'" value="" class="getpaid_js_field-state form-control"/>';else s='<input type="text" name="'+n.field_name+'" value="" class="getpaid_js_field-state regular-text"/>';e(".getpaid_js_field-state").removeClass("custom-select").addClass(t),e(".getpaid_js_field-state").replaceWith(s)}else{(a=e(a)).attr("id",n.field_name),e(".getpaid_js_field-state").replaceWith(a),e(".getpaid_js_field-state").removeClass("form-control").addClass(t).addClass("custom-select")}e(".getpaid_js_field-state").val(o)})).fail((function(){var i='<input type="text" name="'+n.field_name+'" value="" class="getpaid_js_field-state regular-text"/>';e(".getpaid_js_field-state").replaceWith(i)})).always((function(){e(".getpaid_js_field-state").fadeTo(1e3,1)}))}};function u(){e("#wpinv_tax_rates tbody tr").each((function(i){e(this).find(":input[name^='tax_rates']").each((function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+i+"]"),e(this).attr("name",t).attr("id",t)}))}))}_(),e(document.body).on("change",".getpaid_js_field-country",_),e(".wpinv_add_tax_rate").on("click",(function(i){i.preventDefault();var t=e("#tmpl-wpinv-tax-rate-row").html();e("#wpinv_tax_rates tbody").append(t),u()})),e(".wpinv_add_tax_rule").on("click",(function(t){t.preventDefault();var n=e("#tmpl-wpinv-tax-rule-row").html();n=n.replace(/TAX_RULE_KEY/g,i()),e("#wpinv-tax-rules tbody").append(n)})),e(document).on("click","#wpinv_tax_rates .wpinv_remove_tax_rate",(function(i){i.preventDefault(),e(this).closest("tr").remove(),u()})),e(document).on("click","#wpinv-tax-rules .wpinv_remove_tax_rule",(function(i){i.preventDefault(),e(this).closest("tr").remove()}));var g={init:function(){this.preSetup()},preSetup:function(){var i=e(".wpinv-color-picker");i.length&&i.wpColorPicker();var t=e("select.wpinv-no-states");function n(){var i=e("#wpinv-settings-enable_recaptcha").is(":checked");e("#wpinv-settings-recaptcha_version").closest("tr").toggle(i),e("#wpinv-settings-recaptcha_site_key").closest("tr").toggle(i),e("#wpinv-settings-recaptcha_secret_key").closest("tr").toggle(i)}t.length&&t.closest("tr").hide(),e('select[name="wpinv_settings[default_country]"]:not(.getpaid_js_field-country)').change((function(){var i=e(this).closest("tr");return o={action:"wpinv_get_states_field",country:e(this).val(),field_name:"wpinv_settings[default_state]"},e.post(WPInv_Admin.ajax_url,o,(function(e){"nostates"==e?i.next().hide():(i.next().show(),i.next().find("select").replaceWith(e))})),!1})),e("#wpinv-settings-enable_recaptcha").on("change",n),n()}};function m(i,t){return e.ajax({url:WPInv_Admin.rest_root+"getpaid/v1/reports/"+i,method:"GET",data:t,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",WPInv_Admin.rest_nonce)}})}function w(i,t,n){var a=e(".getpaid-report-cards .card."+i);if(0!=a.length){!window.Intl||["total_invoices","total_items","refunded_items","period_ticket_sales"].indexOf(i)>-1?(a.find(".getpaid-report-card-value").text(t),a.find(".getpaid-report-card-previous-value").text(n)):(a.find(".getpaid-report-card-value").text(getpaid.currency.format(t)),a.find(".getpaid-report-card-previous-value").text(getpaid.currency.format(n)));var o=0==t||0==n?"":"%";if(t>n){var s=100*(t-n)/n;a.find(".getpaid-report-card-growth").addClass("text-success").html('<i class="fas fa-arrow-up fa-sm pr-1"></i>'+parseFloat(s).toFixed(2)+o)}else if(t<n){var d=100*(t-n)/n;a.find(".getpaid-report-card-growth").addClass("text-danger").html('<i class="fas fa-arrow-down fa-sm pr-1"></i>'+parseFloat(d).toFixed(2)+o)}}}function f(i,t,n){if(0!=e("#getpaid-chartjs-"+i).length){var a=[],o=[],s=[],d=document.getElementById("getpaid-chartjs-"+i).getContext("2d");for(var c in t[0].totals)t[0].totals.hasOwnProperty(c)&&(a.push(c),s.push(t[0].totals[c][i]));for(var c in n[0].totals)n[0].totals.hasOwnProperty(c)&&o.push(n[0].totals[c][i]);var r=t[0].interval>30?0:3;r=t[0].interval<5?10:r,new Chart(d,{type:"line",data:{labels:a,datasets:[{label:e("#getpaid-chartjs-"+i).closest(".card").find(".card-header strong").text(),data:s,backgroundColor:t[0].interval>30?"rgba(255, 255, 255, 0)":"rgba(54, 162, 235, 0.1)",borderColor:"rgb(54, 162, 235)",pointBackgroundColor:"rgb(54, 162, 235)",pointHoverBackgroundColor:"rgba(54, 162, 235, 0.4 )",pointRadius:r,pointHoverRadius:15,lineTension:t[0].interval>30?.1:.4,borderWidth:t[0].interval>30?2:4},{label:"Previous Period",data:o,backgroundColor:"rgba(255, 255, 255, 0)",borderColor:"rgb(77, 201, 246 )",pointBackgroundColor:"rgb(77, 201, 246 )",pointHoverBackgroundColor:"rgba(77, 201, 246, 0.4 )",pointRadius:r,pointHoverRadius:15,lineTension:t[0].interval>30?.1:.4,borderWidth:t[0].interval>30?2:4}]},options:{tooltips:{mode:"index",intersect:!0,callbacks:{label:function(e,t){var n=t.datasets[e.datasetIndex].label||"",a=e.yLabel;return n&&(n+=": "),window.Intl&&-1==["invoices","items","tickets_sold"].indexOf(i)&&(a=getpaid.currency.format(a)),n+=a}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e,t,n){return!window.Intl||["invoices","items","tickets_sold"].indexOf(i)>-1?e:getpaid.currency.format(e)}}},x:{ticks:{maxTicksLimit:12}}},legend:{display:!0,position:"bottom",labels:{generateLabels:function(e){var t=e.data.datasets,n=e.legend.options.labels.usePointStyle;return e._getSortedDatasetMetas().map((function(e){var a=e.controller.getStyle(n?0:void 0),o=t[e.index].data.reduce((function(e,i){return e+i}),0);return window.Intl&&-1==["invoices","items","tickets_sold"].indexOf(i)&&(o=getpaid.currency.format(o)),{text:t[e.index].label+" : "+o,fillStyle:a.backgroundColor,hidden:!1,lineCap:a.borderCapStyle,lineDash:a.borderDash,lineDashOffset:a.borderDashOffset,lineJoin:a.borderJoinStyle,lineWidth:a.borderWidth,strokeStyle:a.borderColor,pointStyle:a.pointStyle,rotation:a.rotation,datasetIndex:e.index}}),this)}}}}})}}function h(){var i="anonymize"===e('[name="wpinv_settings[data_retention_method]').val();e('[name="wpinv_settings[data_retention_period]"]').closest("tr").toggle(i)}e('.getpaid-is-invoice-cpt form#post #titlediv [name="post_title"]').attr("readonly",!0),g.init(),e(".row.getpaid-report-cards").length&&(e(".getpaid-filter-earnings select").on("change",(function(){"custom"==e(this).val()?(e(".getpaid-date-range-picker").removeClass("d-none"),e(".getpaid-date-range-viewer").addClass("d-none")):(e(".getpaid-date-range-picker").addClass("d-none"),e(".getpaid-date-range-viewer").removeClass("d-none"))})),e(".getpaid-filter-earnings select").trigger("change"),wpinvBlock(".single-report-card"),m("sales",WPInv_Admin.date_range).done((function(i){e(".getpaid-date-range-picker .getpaid-from").val(i[0].start_date),e(".getpaid-date-range-picker .getpaid-to").val(i[0].end_date),m("sales",i[0].previous_range).done((function(e){for(var t in wpinvUnblock(".single-report-card"),i[0])i[0].hasOwnProperty(t)&&w(t,i[0][t],e[0][t]);for(var n=WPInv_Admin.graphs,a=0;a<n.length;a++)f(n[a],i,e)}))}))),e(".getpaid-anonymization-logs").length&&e(document).on("click",".getpaid-anonymization-logs .toggle-details",(function(){var i=e(this),t=i.closest("tr").next(".log-details");e(".log-details").not(t).hide(),e(".toggle-details").not(i).attr("aria-expanded","false"),e(".toggle-details").not(i).find(".dashicons").removeClass("dashicons-arrow-up-alt2").addClass("dashicons-arrow-down-alt2"),t.toggle();var n=t.is(":visible");i.attr("aria-expanded",n)})),e('[name="wpinv_settings[data_retention_method]"').on("change",h),h(),e(document).on("input","input.getpaid-force-integer",(function(i){e(this).val((function(e,i){return i.replace(/[^\d.]+/g,"")}))}))}));