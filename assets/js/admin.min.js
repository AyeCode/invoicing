function wpinvBlock(e,t){t=void 0!==t&&""!==t?t:WPInv_Admin.loading;var i=jQuery(e);i.data("GetPaidIsBlocked")?i.data("GetPaidIsBlocked",i.data("GetPaidIsBlocked")+1):(i.data("GetPaidIsBlocked",1),i.data("GetPaidWasRelative",i.hasClass("position-relative")),i.addClass("position-relative"),i.append('<div class="w-100 h-100 position-absolute bg-light d-flex justify-content-center align-items-center getpaid-block-ui" style="top: 0; left: 0; opacity: 0.7; cursor: progress;"><div class="spinner-border" role="status"><span class="sr-only">'+t+"</span></div></div>"))}function wpinvUnblock(e){var t=jQuery(e);if(t.data("GetPaidIsBlocked")){if(t.data("GetPaidIsBlocked")-1>0)return void t.data("GetPaidIsBlocked",t.data("GetPaidIsBlocked")-1);t.data("GetPaidIsBlocked",0),t.data("GetPaidWasRelative")||t.removeClass("position-relative"),t.children(".getpaid-block-ui").remove()}}window.getpaid=window.getpaid||{},getpaid.init_select2_item_search=function(e,t){t||(t=jQuery("#getpaid-add-items-to-invoice"));var i=jQuery(e).data("ignore");jQuery(e).select2({minimumInputLength:3,allowClear:!1,dropdownParent:t,ajax:{url:WPInv_Admin.ajax_url,delay:250,data:function(e){return{action:"wpinv_get_invoicing_items",search:e.term,_ajax_nonce:WPInv_Admin.wpinv_nonce,ignore:i,post_id:WPInv_Admin.post_ID}},processResults:function(e){return e.success?{results:e.data}:{results:[]}}},templateResult:function(e){return e.loading?WPInv_Admin.searching:e.id?jQuery("<span>"+e.text+"</span>"):e.text},language:{inputTooShort:function(){return WPInv_Admin.search_items}}})},getpaid.init_select2_customer_search=function(e,t){t||(t=jQuery(e).parent()),jQuery(e).select2({minimumInputLength:3,allowClear:!1,dropdownParent:t,ajax:{url:WPInv_Admin.ajax_url,delay:250,data:function(e){return{action:"wpinv_get_customers",search:e.term,_ajax_nonce:WPInv_Admin.wpinv_nonce,post_id:WPInv_Admin.post_ID}},processResults:function(e){return e.success?{results:e.data}:{results:[]}}},templateResult:function(e){return e.loading?WPInv_Admin.searching:e.id?jQuery("<span>"+e.text+"</span>"):e.text},language:{inputTooShort:function(){return WPInv_Admin.search_customers}}})},getpaid.currency=new Intl.NumberFormat(void 0,{style:"currency",currency:WPInv_Admin.currency}),jQuery((function(e){function t(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}if(jQuery().tooltip&&e(".wpi-help-tip").tooltip({content:function(){return e(this).prop("title")},tooltipClass:"wpi-ui-tooltip",position:{my:"center top",at:"center bottom+10",collision:"flipfit"},hide:{duration:200},show:{duration:200}}),jQuery("select.wpi_select2").length>0&&(jQuery("select.wpi_select2").select2(),jQuery("select.wpi_select2_nostd").select2({allow_single_deselect:"true"})),e(".getpaid-ajax-item-selector").each((function(){var t=e(this);getpaid.init_select2_item_search(t,e(t).parent())})),e(".getpaid-customer-search").each((function(){var t=e(this);getpaid.init_select2_customer_search(t,e(t).parent())})),e(".getpaid-install-plugin-siwtch-div").on("click",(function(t){t.preventDefault();var i=e(this).find("input");i.prop("checked",!i.prop("checked"))})),e(".getpaid-merge-tags").click((function(){const t=e(this).parent().find(".getpaid-merge-tags-content");t.hasClass("d-none")&&t.css({display:"none"})&&t.removeClass("d-none"),t.slideToggle("fast")})),e("#wpinv_is_recurring").length){var i=function(){e("body").toggleClass("getpaid_is_subscription_item",e("#wpinv_is_recurring").is(":checked")),e("body").toggleClass("getpaid_is_not_subscription_item",!e("#wpinv_is_recurring").is(":checked")),e(".getpaid-price-input").toggleClass("col-sm-4",e("#wpinv_is_recurring").is(":checked")),e(".getpaid-price-input").toggleClass("col-sm-12",!e("#wpinv_is_recurring").is(":checked"))};i(),e(document).on("change","#wpinv_is_recurring",i)}if(e("#wpinv_name_your_price").length){var n=function(){e("body").toggleClass("getpaid_is_dynamic_item",e("#wpinv_name_your_price").is(":checked")),e("body").toggleClass("getpaid_is_not_dynamic_item",!e("#wpinv_name_your_price").is(":checked"))};n(),e(document).on("change","#wpinv_name_your_price",n)}function a(t){t&&t.preventDefault();var i=e(".getpaid-recalculate-prices-on-change").serialize();i+="&action=wpinv_recalculate_full_prices&post_id="+e("#post_ID").val()+"&_ajax_nonce="+WPInv_Admin.wpinv_nonce,wpinvBlock("#wpinv_items_wrap"),e.post(WPInv_Admin.ajax_url,i).done((function(t){t.success&&(t.data.alert?alert(t.data.alert):(e("#wpinv_items_wrap").replaceWith(t.data.table),e("body").trigger("getpaid_on_recalculate_full_prices",t.data)))})).always((function(e){wpinvUnblock("#wpinv_items_wrap")}))}if(e("body.post-type-wpi_item #postexcerpt h2.hndle").text(WPInv_Admin.item_description),e("body.post-type-wpi_discount #postexcerpt h2.hndle").text(WPInv_Admin.discount_description),e("body.getpaid-is-invoice-cpt #postexcerpt h2.hndle").text(WPInv_Admin.invoice_description),e("body.getpaid-is-invoice-cpt #postexcerpt p, body.post-type-wpi_item #postexcerpt p, body.post-type-wpi_discount #postexcerpt p").hide(),e(document).on("change","#wpinv_discount_type",(function(){e("#wpinv_discount_amount_wrap").removeClass("flat percent"),e("#wpinv_discount_amount_wrap").addClass(e(this).val())})),e("#getpaid-invoice-fill-user-details").on("click",(function(t){t.preventDefault();var i=e(this).closest(".bsui"),n=i.find("#wpinv_post_author_override").val();if(n&&!e(this).attr("disabled")){e("#wpinv_first_name, #wpinv_last_name, #wpinv_address, #wpinv_city, #wpinv_zip, #wpinv_company, #wpinv_company_id, #wpinv_phone, #wpinv_vat_number").val(""),wpinvBlock(i);var a={action:"wpinv_get_billing_details",user_id:n,post_id:WPInv_Admin.post_ID,_ajax_nonce:WPInv_Admin.wpinv_nonce};e.get(WPInv_Admin.ajax_url,a).done((function(t){t.success&&(e.each(t.data,(function(t,i){var n=e("#wpinv_"+t);n.length&&n.val(i)})),c())})).always((function(e){wpinvUnblock(i)}))}})),e("#wpinv_post_author_override").on("change",(function(){e(".getpaid-is-invoice-cpt #post_author_override").val(e("#wpinv_post_author_override").val()),e("#getpaid-invoice-fill-user-details").trigger("click")})),e(".getpaid-is-invoice-cpt #post_author_override").replaceWith('<input name="post_author_override" id="post_author_override">'),e(".getpaid-is-invoice-cpt #post_author_override").val(e("#wpinv_post_author_override").val()),e("#getpaid-invoice-create-new-user-button").on("click",(function(t){t.preventDefault(),e("#getpaid-invoice-user-id-wrapper, #getpaid-invoice-create-new-user-button").addClass("d-none"),e("#getpaid-invoice-cancel-create-new-user, #getpaid-invoice-email-wrapper").removeClass("d-none"),e("#getpaid-invoice-fill-user-details").attr("disabled",!0),e("#getpaid-invoice-create-new-user").val(1),e("#getpaid-invoice-new-user-email").prop("required","required"),e("#wpinv_first_name, #wpinv_last_name, #wpinv_company, #wpinv_vat_number, #wpinv_address, #wpinv_city, #wpinv_zip, #wpinv_phone").val("")})),e("#getpaid-invoice-cancel-create-new-user").on("click",(function(t){t.preventDefault(),e("#getpaid-invoice-cancel-create-new-user, #getpaid-invoice-email-wrapper").addClass("d-none"),e("#getpaid-invoice-user-id-wrapper, #getpaid-invoice-create-new-user-button").removeClass("d-none"),e("#getpaid-invoice-fill-user-details").attr("disabled",!1),e("#getpaid-invoice-create-new-user").val(0),e("#getpaid-invoice-new-user-email").val("").prop("required",!1)})),e("#getpaid-invoice-new-user-email").on("change",(function(t){t.preventDefault(),e(this).removeClass("is-invalid").parent().find(".invalid-feedback").remove();var i=e(this).closest(".bsui"),n=e(this).val();wpinvBlock(i);var a={action:"wpinv_check_new_user_email",email:n,post_id:WPInv_Admin.post_ID,_ajax_nonce:WPInv_Admin.wpinv_nonce};e.get(WPInv_Admin.ajax_url,a).done((function(t){if(t.success){if(t.data.id){var i=t.data.id;e("#getpaid-invoice-cancel-create-new-user").trigger("click"),e("#wpinv_post_author_override").find("option[value="+i+"]").length?e("#wpinv_post_author_override").val(i).trigger("change"):e("#wpinv_post_author_override").append(new Option(n,i,!0,!0)).trigger("change")}}else e("#getpaid-invoice-new-user-email").addClass("is-invalid").parent().append('<div class="invalid-feedback">'+t+"</div>")})).always((function(e){wpinvUnblock(i)}))})),e(".getpaid-is-invoice-cpt").on("change","#wpinv_country",(function(t){if(e("#wpinv_state").length){var i=e(this).closest(".row");wpinvBlock(i);var n={action:"wpinv_get_aui_states_field",country:e("#wpinv_country").val(),state:e("#wpinv_state").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce};e.get(WPInv_Admin.ajax_url,n).done((function(t){t.success&&(e("#wpinv_state").closest(".form-group").replaceWith(t.data.html),t.data.select&&e("#wpinv_state").select2())})).always((function(e){wpinvUnblock(i)}))}})),e("#wpinv_template").on("change",(function(t){e(this).closest("#poststuff").removeClass("amount quantity hours").addClass(e(this).val())})),e("#wpinv_template").trigger("change"),function(){var i=[];e("#getpaid-add-items-to-invoice tbody").data("row",e("#getpaid-add-items-to-invoice tbody").html()),e(".getpaid-add-invoice-item-select").select2({dropdownParent:e("#getpaid-add-items-to-invoice .modal-body")}),e(".getpaid-add-invoice-item-select").data("key",t()),e("#getpaid-add-items-to-invoice").on("change",".getpaid-add-invoice-item-select",(function(n){var a=e(this),o=a.data("key");if(a.val()){var s=e.inArray(o,i);if(-1!=s&&i.splice(s,1),!i.length){o=t();var c=e("#getpaid-add-items-to-invoice tbody").data("row");(c=e(c).appendTo("#getpaid-add-items-to-invoice tbody")).find(".getpaid-add-invoice-item-select").data("key",o).select2({dropdownParent:e("#getpaid-add-items-to-invoice .modal-body")}),i.push(o),e("#getpaid-add-items-to-invoice").modal("handleUpdate")}}else-1==e.inArray(o,i)&&i.push(o)}));var n=function(){i=[],e("#getpaid-add-items-to-invoice tbody").html(e("#getpaid-add-items-to-invoice tbody").data("row")),e(".getpaid-add-invoice-item-select").select2({dropdownParent:e("#getpaid-add-items-to-invoice .modal-body")}),e(".getpaid-add-invoice-item-select").data("key",t())};e("#getpaid-add-items-to-invoice .getpaid-cancel").on("click",n),e("#getpaid-add-items-to-invoice .getpaid-add").on("click",(function(){var t=e("#getpaid-add-items-to-invoice tbody tr").map((function(){if(e(this).find("select").val())return{id:e(this).find("select").val(),qty:e(this).find("input").val()}})).get();if(n(),t.length){wpinvBlock(".getpaid-invoice-items-inner");var i={action:"wpinv_add_invoice_items",post_id:e("#post_ID").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce,items:t};e.post(WPInv_Admin.ajax_url,i).done((function(e){e.success&&(s(e.data.items),e.data.alert&&alert(e.data.alert),c())})).always((function(e){wpinvUnblock(".getpaid-invoice-items-inner")}))}}))}(),e(".getpaid-is-invoice-cpt").on("change",".getpaid-recalculate-prices-on-change",a),e(".getpaid-is-invoice-cpt #wpinv-items").on("click",".wpinv-item-remove",(function(){e(this).closest("tr").remove(),a()})),e(".getpaid-is-invoice-cpt").on("click","#wpinv-recalc-totals",a),e(".getpaid-is-invoice-cpt").on("click","#wpinv-add-item",(function(t){t.preventDefault();var i={action:"wpinv_admin_add_invoice_item",post_id:e("#post_ID").val(),item_id:e("#wpinv_invoice_item").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce};wpinvBlock("#wpinv_items_wrap"),e.post(WPInv_Admin.ajax_url,i).done((function(t){t.success&&(t.data.alert?alert(t.data.alert):(e(".wpinv-line-items").append(t.data.row),a()))})).always((function(e){wpinvUnblock("#wpinv_items_wrap")}))})),e(".getpaid-is-invoice-cpt").on("click","#wpinv-new-item",(function(t){t.preventDefault(),e("#wpinv-quick-add").slideToggle("fast")})),e(".getpaid-is-invoice-cpt").on("click","#wpinv-cancel-item",(function(t){return t.preventDefault(),e("#wpinv-quick-add").slideToggle("fast"),e("#_wpinv_quick_vat_rule, #_wpinv_quick_vat_class, #_wpinv_quick_type").prop("selectedIndex",0),e(".wpinv-quick-item-name, .wpinv-quick-item-price, .wpinv-quick-item-qty, .wpinv-quick-item-price, .wpinv-quick-item-description").val(""),!1})),e(".getpaid-is-invoice-cpt").on("click","#wpinv-save-item",(function(t){t.preventDefault();var i={action:"wpinv_create_invoice_item",invoice_id:e("#post_ID").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce,_wpinv_quick:{name:e(".wpinv-quick-item-name").val(),price:e(".wpinv-quick-item-price").val(),qty:e(".wpinv-quick-item-qty").val(),description:e(".wpinv-quick-item-description").val(),type:e(".wpinv-quick-type").val(),vat_rule:e(".wpinv-quick-vat-rule").val(),vat_class:e(".wpinv-quick-vat-class").val(),"one-time":e("#_wpinv_quick-one-time").is(":checked")?1:0}};i._wpinv_quick.name?i._wpinv_quick.price?(wpinvBlock("#wpinv_items_wrap"),e.post(WPInv_Admin.ajax_url,i).done((function(t){t.success&&(t.data.alert?alert(t.data.alert):(e(".wpinv-line-items").append(t.data.row),a()))})).always((function(e){wpinvUnblock("#wpinv_items_wrap")}))):e(".wpinv-quick-item-price").focus():e(".wpinv-quick-item-name").focus()})),e("#wpinv-items .getpaid-invoice-items-inner").hasClass("has-items")){var o={action:"wpinv_get_invoice_items",post_id:e("#post_ID").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce};wpinvBlock(".getpaid-invoice-items-inner"),e.post(WPInv_Admin.ajax_url,o).done((function(e){e.success&&s(e.data.items)})).always((function(e){wpinvUnblock(".getpaid-invoice-items-inner")}))}function s(t){e("tr.getpaid-invoice-item").remove();var i="no-items";e.each(t,(function(t,n){i="has-items";var a=e("tr.getpaid-invoice-item-template").clone();a.removeClass("getpaid-invoice-item-template d-none").addClass("getpaid-invoice-item item-"+n.id),e.each(n.texts,(function(e,t){a.find("."+e).html(t)})),a.data("inputs",n.inputs).appendTo("#wpinv-items .getpaid_invoice_line_items")})),e(".getpaid-invoice-items-inner").removeClass("no-items has-items").addClass(i)}function c(){var t={country:e("#wpinv_country").val(),state:e("#wpinv_state").val(),currency:e("#wpinv_currency").val(),taxes:e("#wpinv_taxable:checked").length,action:"wpinv_recalculate_invoice_totals",post_id:e("#post_ID").val(),discount_code:e("#wpinv_discount_code").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce};e("#wpinv_vat_number").length&&(t.vat_number=e("#wpinv_vat_number").val()),wpinvBlock(".getpaid-invoice-items-inner"),e.post(WPInv_Admin.ajax_url,t).done((function(t){if(t.success){var i=t.data.totals;e.each(i,(function(t,i){e("tr.getpaid-totals-"+t).find(".value").html(i)})),t.data.alert&&alert(t.data.alert)}})).always((function(e){wpinvUnblock(".getpaid-invoice-items-inner")}))}e(".getpaid-is-invoice-cpt").on("click",".getpaid-item-actions .dashicons-trash",(function(t){t.preventDefault(),wpinvBlock(".getpaid-invoice-items-inner");var i=e(this).closest(".getpaid-invoice-item").data("inputs"),n=this,a={action:"wpinv_remove_invoice_item",post_id:e("#post_ID").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce,item_id:i["item-id"]};e.post(WPInv_Admin.ajax_url,a).done((function(t){t.success&&(e(n).closest(".getpaid-invoice-item").remove(),e(".getpaid-invoice-items-inner").removeClass("no-items has-items"),e("tr.getpaid-invoice-item").length?e(".getpaid-invoice-items-inner").addClass("has-items"):e(".getpaid-invoice-items-inner").addClass("no-items"),c())})).always((function(e){wpinvUnblock(".getpaid-invoice-items-inner")}))})),e(".getpaid-is-invoice-cpt").on("click",".getpaid-item-actions .dashicons-edit",(function(t){t.preventDefault();var i=e(this).closest(".getpaid-invoice-item").data("inputs");(e.each(i,(function(t,i){e("#getpaid-edit-invoice-item .getpaid-edit-item-div ."+t).val(i)})),window.bootstrap&&window.bootstrap.Modal)?new window.bootstrap.Modal(document.getElementById("getpaid-edit-invoice-item")).show():e("#getpaid-edit-invoice-item").modal()})),e("#getpaid-edit-invoice-item .getpaid-cancel").on("click",(function(){e("#getpaid-edit-invoice-item .getpaid-edit-item-div :input").val("")})),e("#getpaid-create-invoice-item .getpaid-cancel").on("click",(function(){e("#getpaid-create-invoice-item .getpaid-create-item-div :input").val("")})),e("#getpaid-edit-invoice-item .getpaid-save").on("click",(function(){var t=e("#getpaid-edit-invoice-item .getpaid-edit-item-div :input").map((function(){return{field:e(this).attr("name"),value:e(this).val()}})).get();e("#getpaid-edit-invoice-item .getpaid-edit-item-div :input").val(""),wpinvBlock(".getpaid-invoice-items-inner");var i={action:"wpinv_edit_invoice_item",post_id:e("#post_ID").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce,data:t};e.post(WPInv_Admin.ajax_url,i).done((function(e){e.success&&(s(e.data.items),e.data.alert&&alert(e.data.alert),c())})).always((function(e){wpinvUnblock(".getpaid-invoice-items-inner")}))})),e("#getpaid-create-invoice-item .getpaid-save").on("click",(function(){var t=e("#getpaid-create-invoice-item .getpaid-create-item-div :input").map((function(){return{field:e(this).attr("name"),value:e(this).val()}})).get();e("#getpaid-create-invoice-item .getpaid-create-item-div :input").val(""),wpinvBlock(".getpaid-invoice-items-inner");var i={action:"wpinv_create_invoice_item",post_id:e("#post_ID").val(),_ajax_nonce:WPInv_Admin.wpinv_nonce,data:t};e.post(WPInv_Admin.ajax_url,i).done((function(e){e.success&&(s(e.data.items),e.data.alert&&alert(e.data.alert),c())})).always((function(e){wpinvUnblock(".getpaid-invoice-items-inner")}))})),e("#wpinv-items .recalculate-totals-button").on("click",(function(e){e.preventDefault(),c()})),e(".getpaid-is-invoice-cpt #wpinv_vat_number, .getpaid-is-invoice-cpt #wpinv_discount_code, .getpaid-is-invoice-cpt #wpinv_taxable").on("change",(function(e){e.preventDefault()})),e(".getpaid-is-invoice-cpt").on("change","#wpinv_country, #wpinv_state",(function(e){c()})),e('.getpaid-is-invoice-cpt form#post [name="post_status"]').attr("type","hidden");var d,r={init:function(){e("#wpinv-notes").on("click","a.add_note",this.add_invoice_note).on("click","a.delete_note",this.delete_invoice_note),e("ul.invoice_notes")[0]&&(e("ul.invoice_notes")[0].scrollTop=e("ul.invoice_notes")[0].scrollHeight)},add_invoice_note:function(){if(e("textarea#add_invoice_note").val()){wpinvBlock("#wpinv-notes");var t={action:"wpinv_add_note",post_id:WPInv_Admin.post_ID,note:e("textarea#add_invoice_note").val(),note_type:e("select#invoice_note_type").val(),_nonce:WPInv_Admin.add_invoice_note_nonce};return e.post(WPInv_Admin.ajax_url,t,(function(t){e("ul.invoice_notes").append(t),e("ul.invoice_notes")[0].scrollTop=e("ul.invoice_notes")[0].scrollHeight,wpinvUnblock("#wpinv-notes"),e("#add_invoice_note").val("")})),!1}},delete_invoice_note:function(t){t.preventDefault();var i=e(this).data("id");e(this).closest("li.note").remove(),e.post(WPInv_Admin.ajax_url,{action:"wpinv_delete_note",note_id:i,_nonce:WPInv_Admin.delete_invoice_note_nonce})}};r.init(),jQuery("#wpinv-details .inside").html()&&(jQuery("#submitpost",jQuery(".wpinv")).detach().appendTo(jQuery("#wpinv-details")),jQuery("#submitdiv",jQuery(".wpinv")).remove(),jQuery("#publishing-action","#wpinv-details").find("input[type=submit]").attr("name","save_invoice").val(WPInv_Admin.save_invoice)),jQuery("#wpinv-address.postbox").html()&&(jQuery("#wpinv_post_author_override","#authordiv").remove(),jQuery("#authordiv",jQuery(".wpinv")).hide()),!jQuery('#post input[name="post_title"]').val()&&(d=jQuery('#wpinv-details input[name="wpinv_number"]').val())&&jQuery('#post input[name="post_title"]').val(d);var p=jQuery(".getpaid-is-invoice-cpt .subsubsub");if(p.is(":visible")){var l=jQuery(".publish",p).find(".count").text();jQuery(".publish",p).find("a").html(WPInv_Admin.status_publish+' <span class="count">'+l+"</span>");var v=jQuery(".wpi-pending",p).find(".count").text();jQuery(".pending",p).find("a").html(WPInv_Admin.status_pending+' <span class="count">'+v+"</span>")}var _=function(){if(e(".getpaid_js_field-country").length&&e(".getpaid_js_field-state").length){e(".getpaid_js_field-state").fadeTo(1e3,.4);var t=e(".getpaid_js_field-state").is(".custom-select, .form-control"),i=e(".getpaid_js_field-state").attr("class"),n={action:"wpinv_get_states_field",country:e(".getpaid_js_field-country").val(),field_name:e(".getpaid_js_field-country").attr("name").replace("country","state"),class:e(".getpaid_js_field-state").attr("class")};e.post(WPInv_Admin.ajax_url,n).done((function(a){var o=e(".getpaid_js_field-state").val();if("nostates"==a){if(t)var s='<input type="text" name="'+n.field_name+'" value="" class="getpaid_js_field-state form-control"/>';else s='<input type="text" name="'+n.field_name+'" value="" class="getpaid_js_field-state regular-text"/>';e(".getpaid_js_field-state").removeClass("custom-select").addClass(i),e(".getpaid_js_field-state").replaceWith(s)}else{(a=e(a)).attr("id",n.field_name),e(".getpaid_js_field-state").replaceWith(a),e(".getpaid_js_field-state").removeClass("form-control").addClass(i).addClass("custom-select")}e(".getpaid_js_field-state").val(o)})).fail((function(){var t='<input type="text" name="'+n.field_name+'" value="" class="getpaid_js_field-state regular-text"/>';e(".getpaid_js_field-state").replaceWith(t)})).always((function(){e(".getpaid_js_field-state").fadeTo(1e3,1)}))}};function u(){e("#wpinv_tax_rates tbody tr").each((function(t){e(this).find(":input[name^='tax_rates']").each((function(){var i=e(this).attr("name");i=i.replace(/\[(\d+)\]/,"["+t+"]"),e(this).attr("name",i).attr("id",i)}))}))}_(),e(document.body).on("change",".getpaid_js_field-country",_),e(".wpinv_add_tax_rate").on("click",(function(t){t.preventDefault();var i=e("#tmpl-wpinv-tax-rate-row").html();e("#wpinv_tax_rates tbody").append(i),u()})),e(".wpinv_add_tax_rule").on("click",(function(i){i.preventDefault();var n=e("#tmpl-wpinv-tax-rule-row").html();n=n.replace(/TAX_RULE_KEY/g,t()),e("#wpinv-tax-rules tbody").append(n)})),e(document).on("click","#wpinv_tax_rates .wpinv_remove_tax_rate",(function(t){t.preventDefault(),e(this).closest("tr").remove(),u()})),e(document).on("click","#wpinv-tax-rules .wpinv_remove_tax_rule",(function(t){t.preventDefault(),e(this).closest("tr").remove()}));var m={init:function(){this.preSetup()},preSetup:function(){var t=e(".wpinv-color-picker");t.length&&t.wpColorPicker();var i=e("select.wpinv-no-states");function n(){var t=e("#wpinv-settings-enable_recaptcha").is(":checked");e("#wpinv-settings-recaptcha_version").closest("tr").toggle(t),e("#wpinv-settings-recaptcha_site_key").closest("tr").toggle(t),e("#wpinv-settings-recaptcha_secret_key").closest("tr").toggle(t)}i.length&&i.closest("tr").hide(),e('select[name="wpinv_settings[default_country]"]:not(.getpaid_js_field-country)').change((function(){var t=e(this).closest("tr");return o={action:"wpinv_get_states_field",country:e(this).val(),field_name:"wpinv_settings[default_state]"},e.post(WPInv_Admin.ajax_url,o,(function(e){"nostates"==e?t.next().hide():(t.next().show(),t.next().find("select").replaceWith(e))})),!1})),e("#wpinv-settings-enable_recaptcha").on("change",n),n()}};function g(t,i){return e.ajax({url:WPInv_Admin.rest_root+"getpaid/v1/reports/"+t,method:"GET",data:i,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",WPInv_Admin.rest_nonce)}})}function w(t,i,n){var a=e(".getpaid-report-cards .card."+t);if(0!=a.length){!window.Intl||["total_invoices","total_items","refunded_items","period_ticket_sales"].indexOf(t)>-1?(a.find(".getpaid-report-card-value").text(i),a.find(".getpaid-report-card-previous-value").text(n)):(a.find(".getpaid-report-card-value").text(getpaid.currency.format(i)),a.find(".getpaid-report-card-previous-value").text(getpaid.currency.format(n)));var o=0==i||0==n?"":"%";if(i>n){var s=100*(i-n)/n;a.find(".getpaid-report-card-growth").addClass("text-success").html('<i class="fas fa-arrow-up fa-sm pr-1"></i>'+parseFloat(s).toFixed(2)+o)}else if(i<n){var c=100*(i-n)/n;a.find(".getpaid-report-card-growth").addClass("text-danger").html('<i class="fas fa-arrow-down fa-sm pr-1"></i>'+parseFloat(c).toFixed(2)+o)}}}function f(t,i,n){if(0!=e("#getpaid-chartjs-"+t).length){var a=[],o=[],s=[],c=document.getElementById("getpaid-chartjs-"+t).getContext("2d");for(var d in i[0].totals)i[0].totals.hasOwnProperty(d)&&(a.push(d),s.push(i[0].totals[d][t]));for(var d in n[0].totals)n[0].totals.hasOwnProperty(d)&&o.push(n[0].totals[d][t]);var r=i[0].interval>30?0:3;r=i[0].interval<5?10:r,new Chart(c,{type:"line",data:{labels:a,datasets:[{label:e("#getpaid-chartjs-"+t).closest(".card").find(".card-header strong").text(),data:s,backgroundColor:i[0].interval>30?"rgba(255, 255, 255, 0)":"rgba(54, 162, 235, 0.1)",borderColor:"rgb(54, 162, 235)",pointBackgroundColor:"rgb(54, 162, 235)",pointHoverBackgroundColor:"rgba(54, 162, 235, 0.4 )",pointRadius:r,pointHoverRadius:15,lineTension:i[0].interval>30?.1:.4,borderWidth:i[0].interval>30?2:4},{label:"Previous Period",data:o,backgroundColor:"rgba(255, 255, 255, 0)",borderColor:"rgb(77, 201, 246 )",pointBackgroundColor:"rgb(77, 201, 246 )",pointHoverBackgroundColor:"rgba(77, 201, 246, 0.4 )",pointRadius:r,pointHoverRadius:15,lineTension:i[0].interval>30?.1:.4,borderWidth:i[0].interval>30?2:4}]},options:{tooltips:{mode:"index",intersect:!0,callbacks:{label:function(e,i){var n=i.datasets[e.datasetIndex].label||"",a=e.yLabel;return n&&(n+=": "),window.Intl&&-1==["invoices","items","tickets_sold"].indexOf(t)&&(a=getpaid.currency.format(a)),n+=a}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e,i,n){return!window.Intl||["invoices","items","tickets_sold"].indexOf(t)>-1?e:getpaid.currency.format(e)}}},x:{ticks:{maxTicksLimit:12}}},legend:{display:!0,position:"bottom",labels:{generateLabels:function(e){var i=e.data.datasets,n=e.legend.options.labels.usePointStyle;return e._getSortedDatasetMetas().map((function(e){var a=e.controller.getStyle(n?0:void 0),o=i[e.index].data.reduce((function(e,t){return e+t}),0);return window.Intl&&-1==["invoices","items","tickets_sold"].indexOf(t)&&(o=getpaid.currency.format(o)),{text:i[e.index].label+" : "+o,fillStyle:a.backgroundColor,hidden:!1,lineCap:a.borderCapStyle,lineDash:a.borderDash,lineDashOffset:a.borderDashOffset,lineJoin:a.borderJoinStyle,lineWidth:a.borderWidth,strokeStyle:a.borderColor,pointStyle:a.pointStyle,rotation:a.rotation,datasetIndex:e.index}}),this)}}}}})}}function h(){var t="anonymize"===e('[name="wpinv_settings[data_retention_method]').val();e('[name="wpinv_settings[data_retention_period]"]').closest("tr").toggle(t)}e('.getpaid-is-invoice-cpt form#post #titlediv [name="post_title"]').attr("readonly",!0),m.init(),e(".row.getpaid-report-cards").length&&(e(".getpaid-filter-earnings select").on("change",(function(){"custom"==e(this).val()?(e(".getpaid-date-range-picker").removeClass("d-none"),e(".getpaid-date-range-viewer").addClass("d-none")):(e(".getpaid-date-range-picker").addClass("d-none"),e(".getpaid-date-range-viewer").removeClass("d-none"))})),e(".getpaid-filter-earnings select").trigger("change"),wpinvBlock(".single-report-card"),g("sales",WPInv_Admin.date_range).done((function(t){e(".getpaid-date-range-picker .getpaid-from").val(t[0].start_date),e(".getpaid-date-range-picker .getpaid-to").val(t[0].end_date),g("sales",t[0].previous_range).done((function(e){for(var i in wpinvUnblock(".single-report-card"),t[0])t[0].hasOwnProperty(i)&&w(i,t[0][i],e[0][i]);for(var n=WPInv_Admin.graphs,a=0;a<n.length;a++)f(n[a],t,e)}))}))),e(".getpaid-anonymization-logs").length&&e(document).on("click",".getpaid-anonymization-logs .toggle-details",(function(){var t=e(this),i=t.closest("tr").next(".log-details");e(".log-details").not(i).hide(),e(".toggle-details").not(t).attr("aria-expanded","false"),e(".toggle-details").not(t).find(".dashicons").removeClass("dashicons-arrow-up-alt2").addClass("dashicons-arrow-down-alt2"),i.toggle();var n=i.is(":visible");t.attr("aria-expanded",n)})),e('[name="wpinv_settings[data_retention_method]"').on("change",h),h();var y={selectors:{template:"#tmpl-getpaid-bulk-change-subscription-status",form:"#subscribers-filter",actions:"#doaction, #doaction2",statusSelect:"#getpaid-bulk-status-select"},init:function(){this.template=e(this.selectors.template),this.template.length&&e(this.selectors.actions).on("click",this.handleActionClick.bind(this))},handleActionClick:function(t){var i=("doaction"===e(t.currentTarget).attr("id")?e('select[name="action"]'):e('select[name="action2"]')).val();if(0===e('input[name="id[]"]:checked').length)return t.preventDefault(),void window.alert(WPInv_Admin.change_sub_status_notice);if("delete"!==i)return"change_status"===i?(t.preventDefault(),void this.openModal()):void 0;t.preventDefault();var n=this;aui_confirm(WPInv_Admin.delete_subscriptions,WPInv_Admin.txt_delete,WPInv_Admin.action_cancel,!0).then((function(t){t&&e(n.selectors.form).trigger("submit")}))},openModal:function(){aui_modal(WPInv_Admin.change_sub_status_title,this.template.html(),"",!0,"","subscription-status-modal");var t=e(".aui-modal");t.on("click",".getpaid-bulk-status-cancel",(function(t){t.preventDefault();var i=e(".aui-modal");if("undefined"!=typeof bootstrap&&bootstrap.Modal){var n=bootstrap.Modal.getInstance(i[0]);n&&n.hide()}else i.modal("hide")})),t.on("click",".getpaid-bulk-status-apply",(function(t){t.preventDefault();var i=e(this),n=e(".aui-modal"),a=n.find(y.selectors.statusSelect).val();a?(i.prop("disabled",!0),i.html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> '+WPInv_Admin.loading),e(y.selectors.form).find('input[name="bulk_status"]').remove(),e("<input>",{type:"hidden",name:"bulk_status",value:a}).appendTo(y.selectors.form),e(y.selectors.form).trigger("submit")):n.find(y.selectors.statusSelect).focus()}))}};y.init(),e(document).on("input",'[name="wpinv_item_price"], [name="wpinv_minimum_price"], input.getpaid-force-integer',(function(t){e(this).val((function(e,t){return t.replace(/[^\d.]+/g,"")}))}))}));